<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>gamejs</title>
  <style type="text/css">
    body {
        background: #ccc;
    }
    #game {
        border: 1px solid #999;
        width: 480px;
        height: 320px;
        margin: 0 auto;
        overflow: hidden;
        position: relative;
    }
    
    #game .layer {
        min-width: 100%;
        min-height: 100%;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    #game #layer-main {
        background: url(img/floor-tile.png);
    }
    
    #game .layer .sprite {
        position: absolute;
    }
    
    #game .layer .sprite span {
        position: absolute;
    }
    
    #game .layer .sprite span.guy-stand,
    #game .layer .sprite span.guy-walk {
        width: 32px;
        height: 32px;
        background-image: url(img/guy.png);
        background-repeat: no-repeat;
        background-position: 0 0;
    }
    #game .layer .sprite span.guy-stand.frame-17,
    #game .layer .sprite span.guy-stand.frame-18,
    #game .layer .sprite span.guy-stand.frame-37,
    #game .layer .sprite span.guy-stand.frame-38 {
        background-position: 0 -32px;
    }
    #game .layer .sprite span.guy-walk.frame-1 {
        background-position: -32px 0;
    }
    #game .layer .sprite span.guy-walk.frame-3 {
        background-position: -64px 0;
    }
  </style>
</head>
<body>
    <div id="game">
        
    </div>
    <script type="text/javascript" src="js/jquery-1.5.min.js"></script>
    <script type="text/javascript" src="js/game.js"></script>
    <script type="text/javascript">
    var world = GameJS.world('#game');
    world.defineAnimation('guy-walk', { frames: 4 });
    world.defineAnimation('guy-stand', { frames: 101 });
    var layer = world.layer('main');
    var sprite = world.sprite('guy');
    sprite.addAnimation('guy-stand');
    layer.add(sprite);
    
    var dir = {dx:0, dy:0};
    var pos = {x:0, y:0};
    
    setInterval(function() {
        sprite.nextFrame();
        pos.x += dir.dx;
        pos.y += dir.dy;
        sprite.x(pos.x).y(pos.y);
    }, 100);
    
    var update_animation = function() {
        if ( dir.dx || dir.dy ) {
            sprite.removeAnimation('guy-stand').addAnimation('guy-walk');
        }
        else {
            sprite.removeAnimation('guy-walk').addAnimation('guy-stand');
        }
    };
    
    $(document).bind('keydown', function(event) {
        if ( !(37 <= event.keyCode && event.keyCode <= 40) ) {
            return;
        }
        event.preventDefault();
        switch(event.keyCode) {
            case 38: dir.dy = -1; break;
            case 40: dir.dy =  1; break;
            case 37: dir.dx = -1; break;
            case 39: dir.dx =  1; break;
        }
        update_animation();
    }).bind('keyup', function(event) {
        if ( !(37 <= event.keyCode && event.keyCode <= 40) ) {
            return;
        }
        event.preventDefault();
        switch(event.keyCode) {
            case 38: dir.dy = 0; break;
            case 40: dir.dy = 0; break;
            case 37: dir.dx = 0; break;
            case 39: dir.dx = 0; break;
        }
        update_animation();
    });
    </script>
</body>
</html>